<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="576px" preserveAspectRatio="none" style="width:1222px;height:576px;background:#FEFEFE;" version="1.1" viewBox="0 0 1222 576" width="1222px" zoomAndPan="magnify"><defs><filter height="300%" id="fhvvso179dgs2" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="251" x="483" y="28.708">Admin/Internal API Dataflow</text><text fill="#000000" font-family="sans-serif" font-size="15" lengthAdjust="spacing" textLength="28" x="372.5" y="46.8765">See</text><a href="https://github.com/RedHatInsights/turnpike" target="_top" title="https://github.com/RedHatInsights/turnpike" xlink:actuate="onRequest" xlink:href="https://github.com/RedHatInsights/turnpike" xlink:show="new" xlink:title="https://github.com/RedHatInsights/turnpike" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="15" lengthAdjust="spacing" text-decoration="underline" textLength="313" x="405.5" y="46.8765">https://github.com/RedHatInsights/turnpike</text></a><text fill="#000000" font-family="sans-serif" font-size="15" lengthAdjust="spacing" textLength="121" x="723.5" y="46.8765">for more details.</text><rect fill="#DDDDDD" height="512.3125" style="stroke:#A80036;stroke-width:1.0;" width="936" x="199" y="58.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="130" x="602" y="70.481">cloud.redhat.com</text><rect fill="#FFFFFF" filter="url(#fhvvso179dgs2)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="235.5" y="175.4063"/><rect fill="#FFFFFF" filter="url(#fhvvso179dgs2)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="235.5" y="291.9375"/><rect fill="#FFFFFF" filter="url(#fhvvso179dgs2)" height="156.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="235.5" y="350.2031"/><rect fill="#FFFFFF" filter="url(#fhvvso179dgs2)" height="97.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="538.5" y="409.6016"/><rect fill="#FFFFFF" filter="url(#fhvvso179dgs2)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="965" y="469"/><rect fill="#FFFFFF" filter="url(#fhvvso179dgs2)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1171.5" y="233.6719"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="42" x2="42" y1="129.1406" y2="516.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="240" x2="240" y1="129.1406" y2="516.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="543" x2="543" y1="129.1406" y2="516.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="970" x2="970" y1="129.1406" y2="516.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1176" x2="1176" y1="129.1406" y2="516.1328"/><rect fill="#FEFECE" filter="url(#fhvvso179dgs2)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="71" x="5" y="93.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="12" y="113.8389">Browser</text><rect fill="#FEFECE" filter="url(#fhvvso179dgs2)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="71" x="5" y="515.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="12" y="535.1279">Browser</text><rect fill="#FEFECE" filter="url(#fhvvso179dgs2)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="71" x="203" y="93.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="210" y="113.8389">turnpike</text><rect fill="#FEFECE" filter="url(#fhvvso179dgs2)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="71" x="203" y="515.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="210" y="535.1279">turnpike</text><rect fill="#FEFECE" filter="url(#fhvvso179dgs2)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="507" x="288" y="77.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="268" x="407.5" y="97.542">rhsm-subscriptions-worker k8s Service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="493" x="295" y="113.8389">(e.g. rhsm-subscriptions-worker-monitoring.rhsm-prod.svc.cluster.local)</text><rect fill="#FEFECE" filter="url(#fhvvso179dgs2)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="507" x="288" y="515.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="268" x="407.5" y="535.1279">rhsm-subscriptions-worker k8s Service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="493" x="295" y="551.4248">(e.g. rhsm-subscriptions-worker-monitoring.rhsm-prod.svc.cluster.local)</text><rect fill="#FEFECE" filter="url(#fhvvso179dgs2)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="318" x="809" y="93.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="304" x="816" y="113.8389">rhsm-subscriptions-worker Deployment Pod</text><rect fill="#FEFECE" filter="url(#fhvvso179dgs2)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="318" x="809" y="515.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="304" x="816" y="535.1279">rhsm-subscriptions-worker Deployment Pod</text><rect fill="#FEFECE" filter="url(#fhvvso179dgs2)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="67" x="1141" y="93.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="1148" y="113.8389">RH SSO</text><rect fill="#FEFECE" filter="url(#fhvvso179dgs2)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="67" x="1141" y="515.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="1148" y="535.1279">RH SSO</text><rect fill="#FFFFFF" filter="url(#fhvvso179dgs2)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="235.5" y="175.4063"/><rect fill="#FFFFFF" filter="url(#fhvvso179dgs2)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="235.5" y="291.9375"/><rect fill="#FFFFFF" filter="url(#fhvvso179dgs2)" height="156.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="235.5" y="350.2031"/><rect fill="#FFFFFF" filter="url(#fhvvso179dgs2)" height="97.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="538.5" y="409.6016"/><rect fill="#FFFFFF" filter="url(#fhvvso179dgs2)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="965" y="469"/><rect fill="#FFFFFF" filter="url(#fhvvso179dgs2)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1171.5" y="233.6719"/><polygon fill="#A80036" points="223.5,171.4063,233.5,175.4063,223.5,179.4063,227.5,175.4063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="42.5" x2="229.5" y1="175.4063" y2="175.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="49.5" y="155.2075">https</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="49.5" y="170.3403">(port 443)</text><polygon fill="#A80036" points="53.5,200.5391,43.5,204.5391,53.5,208.5391,49.5,204.5391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="47.5" x2="239.5" y1="204.5391" y2="204.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="59.5" y="199.4731">redirect to saml login</text><polygon fill="#A80036" points="1159.5,229.6719,1169.5,233.6719,1159.5,237.6719,1163.5,233.6719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="42.5" x2="1165.5" y1="233.6719" y2="233.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="49.5" y="228.606">authentication</text><polygon fill="#A80036" points="53.5,258.8047,43.5,262.8047,53.5,266.8047,49.5,262.8047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="47.5" x2="1175.5" y1="262.8047" y2="262.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="59.5" y="257.7388">saml assertion</text><polygon fill="#A80036" points="223.5,287.9375,233.5,291.9375,223.5,295.9375,227.5,291.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="42.5" x2="229.5" y1="291.9375" y2="291.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="49.5" y="286.8716">login via SAML assertion</text><polygon fill="#A80036" points="53.5,317.0703,43.5,321.0703,53.5,325.0703,49.5,321.0703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="47.5" x2="239.5" y1="321.0703" y2="321.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="59.5" y="316.0044">redirect to original request</text><polygon fill="#A80036" points="223.5,346.2031,233.5,350.2031,223.5,354.2031,227.5,350.2031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="42.5" x2="229.5" y1="350.2031" y2="350.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="49.5" y="345.1372">(original request)</text><polygon fill="#A80036" points="526.5,405.6016,536.5,409.6016,526.5,413.6016,530.5,409.6016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="245.5" x2="532.5" y1="409.6016" y2="409.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="252.5" y="374.27">http w/ x-rh-identity header</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="252.5" y="389.4028">having info from SAML assertion</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="252.5" y="404.5356">(port 9000)</text><path d="M553,365.7695 L553,405.7695 L1022,405.7695 L1022,375.7695 L1012,365.7695 L553,365.7695 " fill="#FBFB77" filter="url(#fhvvso179dgs2)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1012,365.7695 L1012,375.7695 L1022,375.7695 L1012,365.7695 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="448" x="559" y="382.8364">You can see an example of the info from the saml assertion by visiting</text><a href="https://internal.cloud.redhat.com/api/turnpike/identity/" target="_top" title="https://internal.cloud.redhat.com/api/turnpike/identity/" xlink:actuate="onRequest" xlink:href="https://internal.cloud.redhat.com/api/turnpike/identity/" xlink:show="new" xlink:title="https://internal.cloud.redhat.com/api/turnpike/identity/" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="343" x="559" y="397.9692">https://internal.cloud.redhat.com/api/turnpike/identity/</text></a><polygon fill="#A80036" points="953,465,963,469,953,473,957,469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="548.5" x2="959" y1="469" y2="469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="555.5" y="433.6685">http w/ x-rh-identity header</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="555.5" y="448.8013">having info from SAML assertion</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="555.5" y="463.9341">(port 9000)</text><polygon fill="#A80036" points="53.5,494.1328,43.5,498.1328,53.5,502.1328,49.5,498.1328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="47.5" x2="969" y1="498.1328" y2="498.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="59.5" y="493.0669">Response JSON</text><!--MD5=[c9a0f426dc3c47b6a9fab669534b81f3]
@startuml

' see https://forum.plantuml.net/8356/white-backgrounds-are-rendered-transparent-in-svg
skinparam backgroundColor #FEFEFE

title Admin/Internal API Dataflow\n<sub>See [[https://github.com/RedHatInsights/turnpike]] for more details.</sub>

autoactivate on

participant Browser

box cloud.redhat.com
participant turnpike
participant service as "rhsm-subscriptions-worker k8s Service\n(e.g. rhsm-subscriptions-worker-monitoring.rhsm-prod.svc.cluster.local)"
participant pod as "rhsm-subscriptions-worker Deployment Pod"
end box

participant sso as "RH SSO"

Browser -> turnpike: https\n(port 443)

return redirect to saml login

Browser -> sso: authentication
return saml assertion

Browser -> turnpike: login via SAML assertion
return redirect to original request

Browser -> turnpike: (original request)

turnpike -> service: http w/ x-rh-identity header\nhaving info from SAML assertion\n(port 9000)
note right: You can see an example of the info from the saml assertion by visiting\n[[https://internal.cloud.redhat.com/api/turnpike/identity/]]

service -> pod: http w/ x-rh-identity header\nhaving info from SAML assertion\n(port 9000)

pod - -> Browser : Response JSON

@enduml

@startuml

skinparam backgroundColor #FEFEFE

title Admin/Internal API Dataflow\n<sub>See [[https://github.com/RedHatInsights/turnpike]] for more details.</sub>

autoactivate on

participant Browser

box cloud.redhat.com
participant turnpike
participant service as "rhsm-subscriptions-worker k8s Service\n(e.g. rhsm-subscriptions-worker-monitoring.rhsm-prod.svc.cluster.local)"
participant pod as "rhsm-subscriptions-worker Deployment Pod"
end box

participant sso as "RH SSO"

Browser -> turnpike: https\n(port 443)

return redirect to saml login

Browser -> sso: authentication
return saml assertion

Browser -> turnpike: login via SAML assertion
return redirect to original request

Browser -> turnpike: (original request)

turnpike -> service: http w/ x-rh-identity header\nhaving info from SAML assertion\n(port 9000)
note right: You can see an example of the info from the saml assertion by visiting\n[[https://internal.cloud.redhat.com/api/turnpike/identity/]]

service -> pod: http w/ x-rh-identity header\nhaving info from SAML assertion\n(port 9000)

pod - -> Browser : Response JSON

@enduml

PlantUML version 1.2021.00(Sun Jan 10 10:25:05 UTC 2021)
(LGPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>